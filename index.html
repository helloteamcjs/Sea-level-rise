<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sea-level-rise</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background-color: #1a1a1a;
            font-family: 'Source Code Pro', monospace;
            transition: background-color 0.1s ease-out;
        }
        body { 
            position: relative; /* ìì‹(header)ì˜ ìœ„ì¹˜ ê¸°ì¤€ì  */
        }
        main {
            width: 100%;
            height: 100%;
            display: flex; 
            flex-direction: column; 
            justify-content: center;
            align-items: center;
        }
        .chart-wrapper {
            width: 90%;
            max-width: 900px;
        }
        #vis-main-container { height: 400px; margin-bottom: 20px; }
        #vis-aux-container { height: 250px; }
        
        .slider-wrapper {
            margin-top: 10px;
            width: 90%;
            max-width: 900px;
            height: 50px;
            position: relative;
            padding: 0 24px;
            box-sizing: border-box;
        }
        #year-slider-horizontal {
            width: 100%;
            margin: 10px 0 0 0;
            -webkit-appearance: none;
            appearance: none;
            height: 10px;
            background: #495057;
            outline: none;
            border-radius: 5px;
        }
        #year-slider-horizontal::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: white;
            cursor: pointer;
            border-radius: 50%;
            transition: background 0.1s ease-out;
        }
        #year-slider-horizontal::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: white;
            cursor: pointer;
            border-radius: 50%;
            transition: background 0.1s ease-out;
        }
        #year-display-wrapper {
            position: absolute;
            top: -13px;
            left: 0;
            width: 100%;
            height: 20px;
        }
        #year-display {
            color: white;
            font-size: 13px;
            font-style: normal;
            position: absolute;
            transform: translateX(-50%);
        }
        .vg-tooltip {
            font-family: 'Source Code Pro', monospace !important;
            font-size: 11px !important;
        }
        .page-title {
    position: absolute;
    top: 50%;
    right: 20px;
    transform: translateY(-100%);
    text-align: right;
    font-size: 11px;
    color: white;
    line-height: 1.6;
    z-index: 10;
}
    </style>
</head>
<body>
    <header class="page-title">
        ê³¼ê±°: 1993-2020 ì‹¤ì¸¡ ë°ì´í„°<br>
        ë¯¸ë˜: ë³€í™” ì¶”ì„¸ë¥¼ í•™ìŠµí•œ AIì˜ ì˜ˆì¸¡<br>
        ê²°ë¡ : 2100ë…„ íŒŒë©¸ ì‹œë‚˜ë¦¬ì˜¤<br><br>
        Past: Observed data from 1993-2020<br>
        Future: AI forecast based on trend analysis<br>
        Conclusion: A catastrophic scenario in 2100
    </header>

    <main>
        <div class="chart-wrapper" id="vis-main-container"></div>
        <div class="chart-wrapper" id="vis-aux-container"></div>
        
        <div class="slider-wrapper">
            <input type="range" id="year-slider-horizontal" min="1993" max="2100" step="1" value="1993">
            <div id="year-display-wrapper">
                <span id="year-display">1993</span>
            </div>
        </div>
    </main>

    <script>
        let blinkingInterval = null;
        const embedOpt = { "mode": "vega-lite", "actions": false };
        const specCircularUrl = 'chart_main_final.json';
        const specLinesUrl = 'chart_aux_final.json';
        let chartData = [];

        Promise.all([
            fetch(specCircularUrl).then(res => res.json()), 
            fetch(specLinesUrl).then(res => res.json()),
            vegaEmbed('#vis-main-container', specCircularUrl, embedOpt),
            vegaEmbed('#vis-aux-container', specLinesUrl, embedOpt)
        ]).then(([mainSpec, auxSpec, resultCircular, resultLines]) => {
            chartData = mainSpec.data.values; 
            const mainView = resultCircular.view;
            const auxView = resultLines.view;
            const slider = document.getElementById('year-slider-horizontal');
            const yearDisplay = document.getElementById('year-display');
            const styleElement = document.createElement('style');
            document.head.appendChild(styleElement);
            const sliderWrapper = document.querySelector('.slider-wrapper');
            
            const onSliderChange = (yearValue) => {
                const year = parseInt(yearValue);
                const mainContainer = document.getElementById('vis-main-container');
if (year === 2100) {
    if (!blinkingInterval) { // ê¹œë¹¡ì„ì´ êº¼ì ¸ìˆì„ ë•Œë§Œ ì‹¤í–‰
        blinkingInterval = setInterval(() => {
            mainContainer.style.opacity = mainContainer.style.opacity === '0' ? '1' : '0';
        }, 500); // 0.5ì´ˆ ê°„ê²©ìœ¼ë¡œ ê¹œë¹¡ì„
    }
} else {
    if (blinkingInterval) { // ê¹œë¹¡ì„ì´ ì¼œì ¸ìˆì„ ë•Œë§Œ ì‹¤í–‰
        clearInterval(blinkingInterval);
        blinkingInterval = null;
        mainContainer.style.opacity = '1'; // ë‹¤ì‹œ ë³´ì´ë„ë¡ í™•ì‹¤í•˜ê²Œ ì„¤ì •
    }
}
                mainView.signal('year_slider', year).run();
                auxView.signal('selectedYear', year).run();
                
                let grayValue;
if (year <= 2085) {
    // 1993ë…„ë¶€í„° 2085ë…„ê¹Œì§€: ì–´ë‘ìš´ íšŒìƒ‰ -> ê²€ì€ìƒ‰
    const bgRatio = (year - 1993) / (2085 - 1993);
    grayValue = Math.round(26 * (1 - bgRatio));
} else {
    // 2085ë…„ ì´í›„ë¶€í„° 2100ë…„ê¹Œì§€: ê²€ì€ìƒ‰ -> í°ìƒ‰
    const bgRatio = (year - 2085) / (2100 - 2085);
    grayValue = Math.round(255 * bgRatio);
}
document.body.style.backgroundColor = `rgb(${grayValue}, ${grayValue}, ${grayValue})`;
                
                const currentYearData = chartData.find(d => d.Year === year);
                if (currentYearData) {
                    const tempAnomaly = currentYearData.Temp_Anomaly_C;
                    const colorScale = mainView.scale('color');
                    const color = colorScale(tempAnomaly);
                    styleElement.innerHTML = `
                        #year-slider-horizontal::-webkit-slider-thumb { background: ${color}; }
                        #year-slider-horizontal::-moz-range-thumb { background: ${color}; }
                    `;
                }

                const computedStyle = window.getComputedStyle(sliderWrapper);
                const wrapperPadding = parseFloat(computedStyle.paddingLeft);
                const sliderRatio = (year - 1993) / (2100 - 1993);
                const sliderTrackWidth = slider.offsetWidth;
                const thumbWidth = 20;

                const thumbPosition = sliderRatio * (sliderTrackWidth - thumbWidth) + (thumbWidth / 2);
                
                yearDisplay.style.left = wrapperPadding + thumbPosition + 'px';
                yearDisplay.textContent = year;
            };

            slider.addEventListener('input', (event) => {
                onSliderChange(event.target.value);
            });
                        // ğŸ”¹ í‚¤ë³´ë“œ í™”ì‚´í‘œë¡œ ì œì–´
            document.addEventListener('keydown', (e) => {
                if (!slider) return;
                if (e.key === 'ArrowRight') {
                    slider.value = Math.min(parseInt(slider.value) + 1, slider.max);
                    slider.dispatchEvent(new Event('input'));
                }
                if (e.key === 'ArrowLeft') {
                    slider.value = Math.max(parseInt(slider.value) - 1, slider.min);
                    slider.dispatchEvent(new Event('input'));
                }
            });
            // ğŸ”¹ ë§ˆìš°ìŠ¤ íœ ë¡œ ì œì–´
            window.addEventListener('wheel', (e) => {
                if (!slider) return;
                e.preventDefault(); // í˜ì´ì§€ ìŠ¤í¬ë¡¤ ë°©ì§€
                const delta = e.deltaY > 0 ? 1 : -1;
                slider.value = Math.min(Math.max(parseInt(slider.value) + delta, slider.min), slider.max);
                slider.dispatchEvent(new Event('input'));
            }, { passive: false });

            setTimeout(() => onSliderChange(slider.value), 100);
            window.addEventListener('resize', () => onSliderChange(slider.value));
        }).catch(console.error);
    </script>
</body>
</html>